<%= javascript_include_tag "interest_ops" %>
<%= javascript_include_tag "jscroll" %>

<%= content_for :middletop do %>

  <h1><span class="heading_subtelize"><%= (@interest.i_private)? 'Private interest:' : 'Interest:' %></span> <%= @interest.title %></h1>
<% end %>

<div id="interest" data-id="<%= @interest.id %>">
  <%# debug(@previous_visit_record) %>
  <h2 class="post_size"><%= pluralize(@interest.post_content(@interest.user).size.to_s, 'message') %></h2>
beads: <% @interest.beads.each do |beader| %>
  | <%= link_to beader.title, beader %>
  <% end %>
<h3><%= (current_user == @interest.user)? link_to('Edit', edit_interest_path(@interest)) : (link_to('adpopt', adopt_interest_path(@interest)))  %></h3>

<%= render 'posts/form' %>
</div>
  
<%#= render :partial => @interest.post_content %>
  <div class="dynamic" id="buffer" style="display: none"></div>
<div class="dynamic" id="postcontent" data-time="<%= @previous_visit_record.to_i %>">
  <div class="post" data-time="<%= Time.now.to_i %>"><img src='/images/loader.gif'/> Loading messages...</div>
</div>

<% content_for :rightside do %>
  <%# debug(@interest.nearest_beads_combination(3)) %>
  <h2 class="memory_post_size"><%= pluralize(@interest.memorized_post_content(true,@interest.user).size.to_s, 'memory') %></h2>
  <%#= @interest.memorized_post_content.empty? ? content_tag(:p, "No memories in this interest", :class => 'side_note') : content_tag(:h2, 'Memories') %>
  <div class="dynamic" id="memories">
    <div class="post" data-time="<%= Time.now.to_i %>"><img src='/images/loader.gif'/> Loading memories...</div>
  </div>
<% end %>

<% content_for :leftside do %><div class="activated_post_container"></div>
<% if current_user == @interest.user and @interest.trusts.present? %>
	<h2>You trust this interest to</h2><br />
	<%= render :partial => 'trusts/outgoing_trust', :collection => @interest.trusts %>
<% end %>
<%# debug(@interest.trusts.map(&:trustee_id)) %>
<% if current_user == @interest.user and @interest.incoming_unconfirmed_trusts.present? %>
        <h2>Trusts from</h2><br />
	<%= render :partial => 'trusts/incoming_trust', :collection => @interest.incoming_unconfirmed_trusts %>
<% end %>

<% end %>
